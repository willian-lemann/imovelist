generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model add_listing_indices {
  id         Int       @id @default(autoincrement())
  created_at DateTime? @db.Timestamptz(6)
  updated_at DateTime? @db.Timestamptz(6)
}

model Galleries {
  id            Int       @id @default(autoincrement())
  listing_id    Int?
  url           String    @db.VarChar(255)
  filename      String    @db.VarChar(255)
  mime_type     String?   @db.VarChar(255)
  size          Int?
  order         Int?      @default(0)
  created_at    DateTime? @db.Timestamptz(6)
  updated_at    DateTime? @db.Timestamptz(6)
  originalImage String
  editedImage   String
  prompt        String?
  listingId     String?
  userId        String
  Listings      Listings? @relation(fields: [listing_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "galleries_listing_id_foreign")

  @@index([listing_id, order], map: "galleries_listing_id_order_index")
  @@map("galleries")
}

model Listings {
  id                Int         @id @default(autoincrement())
  agent_id          String?     @db.VarChar(255)
  name              String?     @db.VarChar(255)
  link              String?     @db.VarChar(255)
  image             String?     @db.VarChar(255)
  address           String?     @db.VarChar(255)
  price             String?     @db.VarChar(255)
  area              Int?
  bedrooms          Int?
  type              String?     @db.VarChar(255)
  for_sale          Boolean?
  parking           Int?
  content           String?
  photos            Json?       @default("[]")
  agency            String?     @db.VarChar(255)
  bathrooms         Int?
  ref               String?     @db.VarChar(255)
  placeholder_image String?     @db.VarChar(255)
  published         Boolean     @default(false)
  created_at        DateTime?   @default(now()) @db.Timestamptz(6)
  updated_at        DateTime?   @default(now()) @db.Timestamptz(6)
  Galleries         Galleries[]
  User              User?       @relation(fields: [agent_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "listings_agent_id_foreign")

  @@index([created_at(sort: Desc)], map: "idx_listings_created_at")
  @@index([for_sale], map: "idx_listings_for_sale")
  @@index([price], map: "idx_listings_price")
  @@index([ref], map: "idx_listings_ref")
  @@index([type], map: "idx_listings_type")
  @@map("listings")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.

model Policies {
  id         Int       @id @default(autoincrement())
  created_at DateTime? @db.Timestamptz(6)
  updated_at DateTime? @db.Timestamptz(6)

  @@map("policies")
}

model Scrapped_infos {
  id             Int       @id @default(autoincrement())
  total_pages    Int?
  total_listings Int?
  agency         String?   @db.VarChar(255)
  created_at     DateTime? @db.Timestamptz(6)
  updated_at     DateTime? @db.Timestamptz(6)

  @@map("scrapped_infos")
}

model Scrapped_listings {
  id                Int       @id @default(autoincrement())
  name              String?   @db.VarChar(255)
  link              String?   @db.VarChar(255)
  image             String?   @db.VarChar(255)
  address           String?   @db.VarChar(255)
  price             Decimal?  @db.Decimal(12, 2)
  area              String?   @db.VarChar(255)
  bedrooms          Int?
  type              String?   @db.VarChar(255)
  for_sale          Boolean?
  parking           Int?
  content           String?
  photos            Json?     @db.Json
  agency            String?   @db.VarChar(255)
  bathrooms         Int?
  ref               String?   @db.VarChar(255)
  placeholder_image String?   @db.VarChar(255)
  agent_id          String?   @db.VarChar(255)
  published         Boolean   @default(false)
  created_at        DateTime? @default(now()) @db.Timestamptz(6)
  updated_at        DateTime? @default(now()) @db.Timestamptz(6)

  @@map("scrapped_listings")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.

model Subscriptions {
  id                     Int       @id @default(autoincrement())
  user_id                String
  abacatepay_customer_id String    @db.VarChar(255)
  abacatepay_billing_id  String    @unique(map: "subscriptions_abacatepay_billing_id_unique") @db.VarChar(255)
  plan                   String    @default("free") @db.VarChar(255)
  status                 String?   @default("pending")
  nextBilling            DateTime? @db.Timestamptz(6)
  created_at             DateTime? @db.Timestamptz(6)
  updated_at             DateTime? @db.Timestamptz(6)
  User                   User      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "subscriptions_user_id_foreign")

  @@map("subscriptions")
}

model User {
  id                     String          @id @default(cuid())
  email                  String          @unique(map: "users_email_unique") @db.VarChar(254)
  profile_photo          String?         @db.VarChar(255)
  cellphone              String?         @db.VarChar(255)
  taxId                  String?         @db.VarChar(255)
  profile_url            String?         @unique(map: "users_profile_url_unique") @db.VarChar(255)
  logo                   String?         @db.VarChar(255)
  abacatepay_customer_id String?         @unique(map: "users_abacatepay_customer_id_unique") @db.VarChar(255)
  stripeCustomerId       String?         @unique
  instagramToken         String?
  instagramUserId        String?
  Listings               Listings[]
  Subscriptions          Subscriptions[]
  stripeSubscriptions    Subscription[]
  name                   String
  emailVerified          Boolean         @default(false)
  image                  String?
  createdAt              DateTime        @default(now())
  updatedAt              DateTime        @updatedAt
  sessions               Session[]
  accounts               Account[]

  @@map("user")
}

model Session {
  id        String   @id
  expiresAt DateTime
  token     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([token])
  @@index([userId])
  @@map("session")
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@index([userId])
  @@map("account")
}

model Verification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([identifier])
  @@map("verification")
}

model Subscription {
  id                   String    @id
  plan                 String
  referenceId          String
  stripeCustomerId     String?
  stripeSubscriptionId String?
  status               String?
  periodStart          DateTime?
  periodEnd            DateTime?
  cancelAtPeriodEnd    Boolean?  @default(false)
  seats                Int?
  trialStart           DateTime?
  trialEnd             DateTime?
  limits               Json?
  metadata             Json?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt
  user                 User      @relation(fields: [referenceId], references: [id], onDelete: Cascade)

  @@index([referenceId])
  @@map("subscription")
}
